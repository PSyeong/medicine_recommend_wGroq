<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>to-DOC의약품 정보 | Medicine Info</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <header class="header">
      <h1 class="logo">💊 to-DOC 의약품 정보</h1>
      <nav class="nav">
        <button class="nav-btn active" data-view="search">검색</button>
        <button class="nav-btn" data-view="interaction">상호작용</button>
        <button class="nav-btn" data-view="pill">알약 식별</button>
        <button class="nav-btn" data-view="pharmacy">근처 약국</button>
        <button class="nav-btn" data-view="notebook">복약수첩</button>
      </nav>
    </header>

    <main class="main">
      <!-- 검색 뷰 -->
      <section class="view view-search active" id="viewSearch">
        <div class="search-layout">
          <div class="icon-panel">
            <h3 class="icon-panel-title">📍 어디가 불편하신가요?</h3>
            <p class="icon-panel-hint">아픈 부위를 클릭해보세요</p>
            <div class="human-icon-wrap">
              <svg class="human-icon" viewBox="0 0 120 200" xmlns="http://www.w3.org/2000/svg">
                <g class="body-part" data-category="머리" title="머리">
                  <circle cx="60" cy="20" r="16" fill="currentColor" class="icon-shape"/>
                </g>
                <g class="body-part" data-category="가슴" title="가슴">
                  <rect x="46" y="40" width="28" height="30" rx="6" fill="currentColor" class="icon-shape"/>
                </g>
                <g class="body-part" data-category="배" title="배">
                  <rect x="46" y="74" width="28" height="30" rx="6" fill="currentColor" class="icon-shape"/>
                </g>
                <g class="body-part" data-categories="관절,피부" title="팔·다리">
                  <path d="M36 55 L14 72 M84 55 L106 72 M54 106 L44 138 M66 106 L76 138" stroke="currentColor" stroke-width="8" stroke-linecap="round" fill="none" class="icon-shape icon-limb"/>
                </g>
              </svg>
            </div>
            <div class="icon-symptoms" id="iconSymptoms"></div>
          </div>
          <div class="search-panel">
            <div class="search-box-wrap">
              <div class="search-box">
                <input type="text" id="searchInput" placeholder="품목명, 분류(소염제·진해거담제 등), 성분명 검색" autocomplete="off">
                <button class="btn btn-primary" id="searchBtn">검색</button>
              </div>
              <div class="autocomplete-dropdown" id="autocompleteDropdown" hidden></div>
            </div>
            <p class="search-hint">왼쪽 그림을 클릭하거나 증상을 입력하세요.</p>
            <div class="symptom-search">
              <div class="category-row">
                <span class="symptom-label">증상별 검색:</span>
                <button class="category-btn" data-category="머리">머리</button>
                <button class="category-btn" data-category="가슴">가슴</button>
                <button class="category-btn" data-category="배">배</button>
                <button class="category-btn" data-category="관절">관절</button>
                <button class="category-btn" data-category="피부">피부</button>
              </div>
              <div class="symptom-row" id="symptomRow"></div>
            </div>
            <div class="search-results" id="searchResults"></div>
          </div>
        </div>
      </section>

      <!-- 상세 정보 뷰 -->
      <section class="view view-detail hidden" id="viewDetail">
        <button class="back-btn" id="backBtn">← 목록으로</button>
        <div class="detail-content" id="detailContent"></div>
      </section>

      <!-- 상호작용 검사 뷰 -->
      <section class="view view-interaction hidden" id="viewInteraction">
        <h2>약물 상호작용 검사</h2>
        <p class="subtitle">복용 중인 약을 추가하고 상호작용을 확인하세요</p>
        <div class="interaction-input">
          <input type="text" id="interactionDrugInput" placeholder="의약품명 입력">
          <button class="btn btn-primary" id="addDrugBtn">추가</button>
        </div>
        <div class="drug-list" id="interactionDrugList"></div>
        <button class="btn btn-secondary" id="checkInteractionBtn">상호작용 검사</button>
        <div class="interaction-result" id="interactionResult"></div>
      </section>

      <!-- 알약 식별 뷰 -->
      <section class="view view-pill hidden" id="viewPill">
        <h2>알약 식별</h2>
        <p class="subtitle">알약의 모양, 색상, 각인을 입력하세요</p>
        <div class="pill-form">
          <div class="form-row">
          <div class="form-group">
            <label>모양</label>
            <select id="pillShape">
              <option value="">선택</option>
              <option value="round">원형</option>
              <option value="oval">타원형</option>
              <option value="capsule">캡슐형</option>
              <option value="rectangle">사각형</option>
              <option value="diamond">다이아몬드</option>
              <option value="hexagon">육각형</option>
              <option value="octagon">팔각형</option>
              <option value="triangle">삼각형</option>
            </select>
          </div>
          <div class="form-group">
            <label>색상</label>
            <select id="pillColor">
              <option value="">선택</option>
              <option value="white">흰색</option>
              <option value="yellow">노란색</option>
              <option value="orange">주황색</option>
              <option value="red">빨간색</option>
              <option value="pink">분홍색</option>
              <option value="blue">파란색</option>
              <option value="green">초록색</option>
              <option value="brown">갈색</option>
              <option value="gray">회색</option>
            </select>
          </div>
          <div class="form-group">
            <label>각인 (문자/숫자)</label>
            <input type="text" id="pillImprint" placeholder="예: G4, 500">
          </div>
          </div>
          <button class="btn btn-primary" id="identifyPillBtn">알약 찾기</button>
        </div>
        <div class="pill-results" id="pillResults"></div>
      </section>

      <!-- 내 복용약 뷰 -->
      <section class="view view-medications hidden" id="viewMedications">
        <h2>내 복용 약 목록</h2>
        <p class="subtitle">저장된 약으로 상호작용·알레르기를 검사할 수 있습니다</p>
        <div class="medication-input">
          <input type="text" id="medicationInput" placeholder="의약품명 입력">
          <button class="btn btn-primary" id="addMedicationBtn">추가</button>
        </div>
        <div class="medication-list" id="medicationList"></div>
        <div class="medication-actions">
          <button class="btn btn-secondary" id="checkAllergyBtn">알레르기 검사</button>
          <button class="btn btn-secondary" id="checkMyInteractionsBtn">상호작용 검사</button>
        </div>
      </section>

      <!-- 복약수첩 뷰 -->
      <section class="view view-notebook hidden" id="viewNotebook">
        <h2>복약수첩</h2>
        <p class="subtitle">환자 정보와 복용약을 정리해 QR 코드로 만들어 보관·공유할 수 있습니다 (응급 시 활용)</p>
        <div class="notebook-form">
          <div class="notebook-section">
            <h3>환자 정보</h3>
            <div class="form-row">
              <div class="form-group">
                <label>이름</label>
                <input type="text" id="notebookName" placeholder="환자 이름">
              </div>
              <div class="form-group">
                <label>생년월일</label>
                <input type="text" id="notebookBirth" placeholder="예: 1990-01-15">
              </div>
              <div class="form-group">
                <label>혈액형</label>
                <select id="notebookBlood">
                  <option value="">선택</option>
                  <option value="A형">A형</option>
                  <option value="B형">B형</option>
                  <option value="O형">O형</option>
                  <option value="AB형">AB형</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>비상연락처</label>
              <input type="text" id="notebookEmergency" placeholder="예: 010-1234-5678 (보호자)">
            </div>
          </div>
          <div class="notebook-section">
            <h3>건강 정보</h3>
            <div class="form-group">
              <label>기저 질환</label>
              <input type="text" id="notebookConditions" placeholder="예: 당뇨, 고혈압 (쉼표 구분)">
            </div>
            <div class="form-group">
              <label>알레르기</label>
              <input type="text" id="notebookAllergy" placeholder="예: 페니실린, 아스피린">
            </div>
            <div class="form-group">
              <label>임신·수유</label>
              <select id="notebookPregnancy">
                <option value="">해당 없음</option>
                <option value="임신">임신 중</option>
                <option value="수유">수유 중</option>
              </select>
            </div>
          </div>
          <div class="notebook-section">
            <h3>복용 약 목록</h3>
            <div class="notebook-med-list" id="notebookMedList"></div>
            <div class="form-group notebook-add-med">
              <input type="text" id="notebookMedInput" placeholder="의약품명 추가">
              <input type="text" id="notebookMedDosage" placeholder="복용법 (예: 1일 3회 식후)">
              <button type="button" class="btn btn-primary btn-sm" id="notebookAddMed">추가</button>
            </div>
          </div>
          <div class="notebook-section">
            <h3>비고</h3>
            <textarea id="notebookNotes" rows="3" placeholder="기타 참고사항 (수술 이력, 주의사항 등)"></textarea>
          </div>
          <div class="notebook-actions">
            <button class="btn btn-primary" id="notebookSaveBtn">저장</button>
            <button class="btn btn-primary" id="notebookQrBtn">QR 코드 생성</button>
          </div>
        </div>
        <div class="notebook-qr-section hidden" id="notebookQrSection">
          <h3>복약수첩 QR 코드</h3>
          <p class="notebook-qr-hint">QR 코드를 스캔하면 복약수첩이 PDF 스타일로 표시됩니다. 인쇄 버튼으로 PDF 저장이 가능합니다.</p>
          <div class="notebook-qr-wrap" id="notebookQrWrap"></div>
          <div class="notebook-qr-actions">
            <button class="btn btn-secondary" id="notebookQrDownload">이미지로 저장</button>
            <button class="btn btn-secondary" id="notebookQrPreview">미리보기 (새 탭)</button>
          </div>
        </div>
      </section>

      <!-- 근처 약국 뷰 -->
      <section class="view view-pharmacy hidden" id="viewPharmacy">
        <h2>근처 약국</h2>
        <p class="subtitle">전국 운영약국을 검색할 수 있습니다. 지역 선택 또는 약국명으로 검색하세요.</p>
        <p class="pharmacy-source">데이터: <a href="https://www.e-gen.or.kr/egen/search_pharmacy.do" target="_blank" rel="noopener">E-GEN(국립중앙의료원)</a> · 대한약사회 제공</p>
        <div class="pharmacy-form">
          <div class="form-row">
            <div class="form-group">
              <label>시·도</label>
              <select id="pharmacySido">
                <option value="">선택</option>
              </select>
            </div>
            <div class="form-group">
              <label>시·군·구</label>
              <select id="pharmacySigugun">
                <option value="">선택</option>
              </select>
            </div>
          </div>
          <div class="form-group pharmacy-name-wrapper" style="position:relative;">
            <label>약국명 검색</label>
            <input type="text" id="pharmacyName" placeholder="예: 삼성, 건강 (부분 일치 검색)" autocomplete="off">
            <div class="pharmacy-name-suggestions" id="pharmacyNameSuggestions"></div>
          </div>
          <button class="btn btn-primary" id="searchPharmacyBtn">약국 검색</button>
        </div>
        <div class="pharmacy-results" id="pharmacyResults"></div>
      </section>
    </main>

    <footer class="footer">
      <p>⚠️ 본 정보는 참고용이며, 의료 상담을 대체하지 않습니다. 전문가와 상담하세요.</p>
    </footer>
  </div>

  <!-- 우측 챗봇 -->
  <div class="chatbot-container" id="chatbotContainer">
    <div class="chatbot-panel" id="chatbotPanel">
      <div class="chatbot-header">
        <h3>💬 의약품 상담 챗봇</h3>
        <button class="chatbot-close" id="chatbotClose" aria-label="챗봇 닫기">×</button>
      </div>
      <div class="chatbot-messages" id="chatbotMessages">
        <div class="chat-msg bot">
          <p>안녕하세요. 의약품에 대해 궁금한 점을 물어보세요. (예: 타이레놀 부작용, 약 상호작용 등)</p>
        </div>
      </div>
      <div class="chatbot-input-area">
        <input type="text" id="chatInput" placeholder="메시지를 입력하세요..." autocomplete="off">
        <button class="chat-send-btn" id="chatSendBtn" aria-label="전송">보내기</button>
      </div>
    </div>
    <button class="chatbot-toggle" id="chatbotToggle" aria-label="챗봇 열기">💬</button>
  </div>

  <!-- 알약 상세 팝오버 (body 직계 - 항상 최상위) -->
  <div class="pill-popover" id="pillPopover" hidden>
    <div class="pill-popover-backdrop" id="pillPopoverBackdrop"></div>
    <div class="pill-popover-content">
      <button class="pill-popover-close" id="pillPopoverClose" type="button" aria-label="닫기">×</button>
      <div id="pillPopoverBody"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js" crossorigin="anonymous"></script>
  <script src="data.js"></script>
  <script src="night-pharmacy-data.js"></script>
  <script>if(typeof NIGHT_PHARMACY==='undefined'){window.NIGHT_PHARMACY=[];}</script>
  <script src="pharmacy-data.js"></script>
  <script>if(typeof PHARMACY_DATA==='undefined'){window.PHARMACY_DATA=[];}</script>
  <script src="app.js"></script>
</body>
</html>
